[supervisord]
nodaemon=true
logfile=/dev/null
pidfile=/tmp/supervisord.pid

; --- AUTOMATIC1111 (WebUI) ---
[program:webui]
command=/bin/bash -lc "cd /opt/webui && source /opt/venv/bin/activate && python launch.py --data-dir ${DATA_DIR:-/workspace/a1111-data} --enable-insecure-extension-access ${WEBUI_ARGS:---listen --api --xformers} --port 7860"
autorestart=true
startsecs=5
stdout_logfile=/dev/fd/1
stderr_logfile=/dev/fd/2
redirect_stderr=true
priority=10

; --- JupyterLab (no auth; proxied at /jupyter) ---
[program:jupyter]
command=/opt/venv/bin/jupyter-lab --ServerApp.token='' --ServerApp.password='' --ServerApp.disable_check_xsrf=True --ServerApp.root_dir=/workspace --ServerApp.default_url=/lab/tree --ServerApp.base_url=/jupyter --ServerApp.allow_remote_access=True --ServerApp.trust_xheaders=True --ServerApp.allow_origin='*' --no-browser --ip=0.0.0.0 --port=8888 --allow-root
autorestart=true
startsecs=5
stdout_logfile=/dev/fd/1
stderr_logfile=/dev/fd/2
redirect_stderr=true
priority=20

; --- nginx (front door on 3000) ---
[program:nginx]
command=/usr/sbin/nginx -g "daemon off;" -c /etc/nginx/nginx.conf
autorestart=true
startsecs=2
stdout_logfile=/dev/fd/1
stderr_logfile=/dev/fd/2
redirect_stderr=true
priority=30
