[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid

; ---------- Automatic1111 ----------
[program:a1111]
directory=/opt/stable-diffusion-webui
; WEBUI_ARGS from env is appended (e.g., --xformers --gradio-auth user:pass)
command=python launch.py --listen --port=%(ENV_WEBUI_PORT)s --api --skip-torch-cuda-test --data-dir=/workspace/a1111 %(ENV_WEBUI_ARGS)s
autostart=true
autorestart=true
startretries=3
priority=10
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
environment=WEBUI_PORT="%(ENV_WEBUI_PORT)s",WEBUI_ARGS="%(ENV_WEBUI_ARGS)s"

; ---------- JupyterLab ----------
[program:jupyter]
directory=/workspace
; JUPYTER_TOKEN (optional) enables auth; leave empty for private pods
command=jupyter lab --ip=0.0.0.0 --port=%(ENV_JUPYTER_PORT)s --no-browser --ServerApp.root_dir=/workspace --ServerApp.base_url=/ --ServerApp.allow_origin="*" --ServerApp.trust_xheaders=True --ServerApp.disable_check_xsrf=True --IdentityProvider.token="%(ENV_JUPYTER_TOKEN)s"
autostart=true
autorestart=true
startretries=3
priority=20
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
environment=JUPYTER_PORT="%(ENV_JUPYTER_PORT)s",JUPYTER_TOKEN="%(ENV_JUPYTER_TOKEN)s"
